window.__require=function e(t,i,a){function n(o,c){if(!i[o]){if(!t[o]){var r=o.split("/");if(r=r[r.length-1],!t[r]){var h="function"==typeof __require&&__require;if(!c&&h)return h(r,!0);if(s)return s(r,!0);throw new Error("Cannot find module '"+o+"'")}o=r}var d=i[o]={exports:{}};t[o][0].call(d.exports,function(e){return n(t[o][1][e]||e)},d,d.exports,e,t,i,a)}return i[o].exports}for(var s="function"==typeof __require&&__require,o=0;o<a.length;o++)n(a[o]);return n}({AnimalCtrl:[function(e,t){"use strict";cc._RF.push(t,"99c7eFRUs9FZqjfq9D/pxmL","AnimalCtrl"),cc.Class({extends:cc.Component,properties:{speed:{default:100,tooltip:"\u79fb\u52a8\u901f\u5ea6"},hp:{default:1,tooltip:"\u751f\u547d\u503c"},type:"Rabbit",hitEffectPrefab:{type:cc.Prefab,default:null},bloodBarPrefab:{type:cc.Prefab,default:null}},onLoad:function(){this.dir=1;var e=cc.find("Canvas/GameManagerNode");e&&(this.gameManager=e.getComponent("GameManager"));var t=cc.find("Canvas/GamePanel/AnimalRoot");t&&(this.spawnManager=t.getComponent("SpawnManager")),this.maxHp=this.hp,this.hp>1&&this.bloodBarPrefab&&(this.bloodBar=cc.instantiate(this.bloodBarPrefab),this.bloodBar.parent=this.node,this.bloodBar.y=this.node.height/2+80,this.bloodCtrl=this.bloodBar.getComponent("BloodBarCtrl"),this.bloodCtrl.setPercent(1))},update:function(e){this.gameManager&&!this.gameManager.isGameOver&&(this.gameManager.isPaused||(this.node.x+=this.speed*this.dir*e,(this.node.x>400||this.node.x<-400)&&this.outOfScreen()))},outOfScreen:function(){this._isDead||(this._isDead=!0,this.spawnManager&&(this.spawnManager.onAnimalDead(),this.spawnManager=null),this.node.destroy())},takeHit:function(){this._isDead||this.gameManager.isPaused||(this.hp-=1,this.bloodCtrl&&this.bloodCtrl.setPercent(this.hp/this.maxHp),this.hp<=0&&this.die())},die:function(){if(!this._isDead){this._isDead=!0;var e=1*({Rabbit:1,Deer:3,Boar:10}[this.type]||0);if(console.log("\u5f97\u5206\uff1a",this.type,e),this.gameManager&&!this.gameManager.isGameOver&&(cc.game.audioManager.playHit(this.type),this.gameManager.addScore(e)),this.hitEffectPrefab){var t=cc.instantiate(this.hitEffectPrefab);t.parent=this.node.parent,t.position=this.node.position;var i=t.getComponent("HitEffectCtrl");i&&i.setScore(e)}this.spawnManager&&(this.spawnManager.onAnimalDead(),this.spawnManager=null),this.node.destroy()}},onCollisionEnter:function(){}}),cc._RF.pop()},{}],AudioManager:[function(e,t){"use strict";cc._RF.push(t,"585f19sAJpOua33Yme2NdPI","AudioManager"),cc.Class({extends:cc.Component,properties:{rotateClip:cc.AudioClip,fireClip:cc.AudioClip,hitRabbit:cc.AudioClip,hitDeer:cc.AudioClip,hitBoar:cc.AudioClip,coinClip:cc.AudioClip,bgmClip:cc.AudioClip},onLoad:function(){cc.game.audioManager=this,this._rotateAudioId=-1,this.bgmClip&&(this._bgmId=cc.audioEngine.play(this.bgmClip,!0,1))},playRotate:function(e){e<.05?this.stopRotate():(-1===this._rotateAudioId&&(this._rotateAudioId=cc.audioEngine.play(this.rotateClip,!0,.4)),cc.audioEngine.setVolume(this._rotateAudioId,Math.min(e,1)))},stopRotate:function(){-1!==this._rotateAudioId&&(cc.audioEngine.stop(this._rotateAudioId),this._rotateAudioId=-1)},playFire:function(){cc.audioEngine.playEffect(this.fireClip,!1)},playHit:function(e){var t=null,i=1;"Rabbit"===e&&(t=this.hitRabbit,i=.2),"Deer"===e&&(t=this.hitDeer,i=1),"Boar"===e&&(t=this.hitBoar,i=1),t&&cc.audioEngine.playEffect(t,!1,i)},playCoin:function(){cc.audioEngine.playEffect(this.coinClip,!1)},pauseBGM:function(){void 0!==this._bgmId&&cc.audioEngine.pause(this._bgmId)},resumeBGM:function(){void 0!==this._bgmId&&cc.audioEngine.resume(this._bgmId)}}),cc._RF.pop()},{}],BallistaCtrl:[function(e,t){"use strict";cc._RF.push(t,"6d9a66uwwxBwYfGLK/33vzG","BallistaCtrl"),cc.Class({extends:cc.Component,properties:{rotateSpeed:{default:.2},boltPrefab:{type:cc.Prefab,default:null}},onLoad:function(){this.isHolding=!1,this.node.on(cc.Node.EventType.TOUCH_START,this.onTouchStart,this),this.node.on(cc.Node.EventType.TOUCH_MOVE,this.onTouchMove,this),this.node.on(cc.Node.EventType.TOUCH_END,this.onTouchEnd,this),this.node.on(cc.Node.EventType.TOUCH_CANCEL,this.onTouchEnd,this),this.gameManager=cc.find("Canvas/GameManagerNode").getComponent("GameManager")},onTouchStart:function(){this.gameManager.isGameOver||this.gameManager.isPaused||(this.isHolding=!0)},onTouchMove:function(e){if(this.isHolding&&!this.gameManager.isPaused){var t=e.getDelta().x;this.node.angle-=t*this.rotateSpeed;var i=.05*Math.abs(t);cc.game.audioManager.playRotate(i)}},onTouchEnd:function(){this.isHolding&&(this.gameManager.isPaused||(this.isHolding=!1,this.fireBolt(),cc.game.audioManager.stopRotate()))},fireBolt:function(){if(!this.gameManager.isGameOver&&!this.gameManager.isPaused){cc.game.audioManager.playFire(),this.gameManager.onShotFired();var e=cc.instantiate(this.boltPrefab);e.parent=this.node.parent,e.position=this.node.position,e.getComponent("BoltCtrl").init(this.node.angle)}}}),cc._RF.pop()},{}],BloodBarCtrl:[function(e,t){"use strict";cc._RF.push(t,"1ca4122TKxNlqjBvGxVNiwe","BloodBarCtrl"),cc.Class({extends:cc.Component,properties:{fill:cc.Node},setPercent:function(e){var t;if(e=Math.max(0,Math.min(1,e)),this.fill.scaleX=e,e>.5){var i=(1-e)/.5;t=cc.color(0+255*i,255,0)}else{var a=e/.5;t=cc.color(255,255*a,0)}this.fill.color=t}}),cc._RF.pop()},{}],BoltCtrl:[function(e,t){"use strict";cc._RF.push(t,"a0c0eY7mYxHvKAsdDPyI1uR","BoltCtrl"),cc.Class({extends:cc.Component,properties:{speed:{default:800,tooltip:"\u7bad\u98de\u884c\u901f\u5ea6"}},onLoad:function(){this.gameManager=cc.find("Canvas/GameManagerNode").getComponent("GameManager"),this.dir=cc.v2(0,1);var e=this.getComponent(cc.Collider);e&&(e.enabled=!1,this.scheduleOnce(function(){e.enabled=!0},.05))},init:function(e){var t=-e*Math.PI/180;this.dir=cc.v2(Math.sin(t),Math.cos(t)),this.node.angle=e},update:function(e){this.gameManager.isPaused||(this.node.x+=this.dir.x*this.speed*e,this.node.y+=this.dir.y*this.speed*e)},onCollisionEnter:function(e){if(!this.gameManager.isPaused&&!this._hasHit){var t=e.node.getComponent("AnimalCtrl");t&&(this._hasHit=!0,this.gameManager.onHit(),t.takeHit(),this.node.destroy())}}}),cc._RF.pop()},{}],CoinTag:[function(e,t){"use strict";cc._RF.push(t,"468dc5oiZxJpbPwQbFCaAkW","CoinTag"),cc.Class({extends:cc.Component}),cc._RF.pop()},{}],GameInit:[function(e,t){"use strict";cc._RF.push(t,"db626uXrJpLDLlTHkd3WoCs","GameInit"),cc.Class({extends:cc.Component,onLoad:function(){cc.director.getCollisionManager().enabled=!0}}),cc._RF.pop()},{}],GameManager:[function(e,t){"use strict";cc._RF.push(t,"da766ETPstPDI9SyGyi7iMP","GameManager"),cc.Class({extends:cc.Component,properties:{scoreLabel:cc.Label,timerLabel:cc.Label,startPanel:cc.Node,homeBg:cc.Node,spriteFrame:cc.SpriteFrame,endPanel:cc.Node,gamePanel:cc.Node,endScoreLabel:cc.Label,bestScoreLabel:cc.Label,endHitRateLabel:cc.Label,gameTime:10,score:0,bestScore:0,pausePanel:cc.Node},onLoad:function(){this.isPaused=!1,this.showPageIndex(1),this.addSprite(),this.loadBestScore()},loadBestScore:function(){var e=localStorage.getItem("BEST_SCORE");this.bestScore=e?parseInt(e):0,this.updateBestScoreUI()},updateBestScoreUI:function(){this.bestScoreLabel.string="\u5386\u53f2\u6700\u9ad8\uff1a"+this.bestScore},showPageIndex:function(e){console.log("\u5207\u6362\u9875\u9762",e),this.startPanel.active=1===e,this.gamePanel.active=2===e,this.endPanel.active=3===e,this.pausePanel.active=4===e,2===e&&this.removeSprite()},addSprite:function(){this.homeBg.getComponent(cc.Sprite)||(this.homeBg.addComponent(cc.Sprite).spriteFrame=this.spriteFrame)},removeSprite:function(){this.homeBg.getComponent(cc.Sprite)&&this.homeBg.removeComponent(cc.Sprite)},startGame:function(){this.reset(),cc.game.audioManager.resumeBGM(),this._timeRemaining=this.gameTime,this._timerActive=!0;var e=cc.find("Canvas/GamePanel/AnimalRoot").getComponent("SpawnManager");console.log("spawnManager",e),e&&(e.isStopped=!1,e.currentAnimal=null,e.spawnAnimal()),console.log("Game Started!")},update:function(e){this.isPaused||this._timerActive&&(this._timeRemaining-=e,this._timeRemaining<=0&&(this._timeRemaining=0,this._timerActive=!1,this.gameOver()),this.timerLabel&&(this.timerLabel.string="\u65f6\u95f4\uff1a"+Math.ceil(this._timeRemaining)))},addScore:function(e){this.score+=e,this.scoreLabel&&(this.scoreLabel.string="\u5f97\u5206\uff1a"+this.score)},reset:function(){this.score=0,this.shotsFired=0,this.hits=0,this._timeRemaining=this.gameTime,this._timerActive=!1,this.isGameOver=!1,this.scoreLabel&&(this.scoreLabel.string="\u5f97\u5206\uff1a0"),this.timerLabel&&(this.timerLabel.string="\u65f6\u95f4\uff1a"+this.gameTime),this.showPageIndex(2)},onShotFired:function(){this.isGameOver||this.shotsFired++},onHit:function(){this.isGameOver||this.hits++},gameOver:function(){if(console.log("Game Over! Score: "+this.score),this.isPaused=!1,cc.director.resume(),cc.audioEngine.pauseAll(),!this.isGameOver){this.isGameOver=!0,this._timerActive=!1;var e=cc.find("Canvas").getComponentsInChildren("BoltCtrl");console.log("\u6e05\u9664\u6240\u6709\u5f29\u7bad",e),e.forEach(function(e){return e.node.destroy()});var t=cc.find("Canvas/GamePanel/Ballista");console.log("\u91cd\u7f6e\u5f29\u8f66\u89d2\u5ea6",t),t&&(t.angle=0);var i=cc.find("Canvas/GamePanel/AnimalRoot").getComponent("SpawnManager");i&&i.stop();var a=0===this.shotsFired?0:Math.round(this.hits/this.shotsFired*100);this.score>this.bestScore&&(this.bestScore=this.score,localStorage.setItem("BEST_SCORE",this.bestScore)),this.updateBestScoreUI(),this.showPageIndex(3),this.endScoreLabel.string="\u672c\u6b21\u5f97\u5206\uff1a"+this.score,this.endHitRateLabel.string="\u547d\u4e2d\u7387\uff1a"+a+"%",cc.game.audioManager.pauseBGM()}},restartGame:function(){this.startGame()},backHome:function(){this.showPageIndex(1),this.addSprite()},pauseGame:function(){this.isPaused||this.isGameOver||(this.isPaused=!0,cc.director.pause(),cc.audioEngine.pauseAll(),this.showPageIndex(4))},resumeGame:function(){this.isPaused&&!this.isGameOver&&(this.isPaused=!1,cc.director.resume(),cc.audioEngine.resumeAll(),this.showPageIndex(2))},exitGame:function(){console.log("\u9000\u51fa\u672c\u5c40"),this.stopGame(),this.addSprite()},stopGame:function(){this.isPaused=!1,cc.director.resume(),cc.audioEngine.stopAll(),this._timerActive=!1,this.isGameOver=!0,cc.find("Canvas").getComponentsInChildren("BoltCtrl").forEach(function(e){return e.node.destroy()});var e=cc.find("Canvas/GamePanel/AnimalRoot").getComponent("SpawnManager");e&&e.stop();var t=cc.find("Canvas/GamePanel/Ballista");t&&(t.angle=0),this.showPageIndex(1),cc.game.audioManager.resumeBGM()},forceRestart:function(){var e=this;console.log("\u5f3a\u5236\u91cd\u65b0\u5f00\u59cb"),this.stopGame(),this.scheduleOnce(function(){e.startGame()},0)}}),cc._RF.pop()},{}],HitEffectCtrl:[function(e,t){"use strict";cc._RF.push(t,"872b26zbvJH+bXXINEkuCsP","HitEffectCtrl"),cc.Class({extends:cc.Component,properties:{coinCount:8,spreadRadius:80,lifeTime:.8,coinLabel:cc.Label},start:function(){var e=this;cc.game.audioManager.playCoin(),this.playCoins(),this.scheduleOnce(function(){e.node.destroy()},this.lifeTime)},playCoins:function(){var e=this,t=this.node.children.filter(function(e){return e.getComponent("CoinTag")});console.log("this.node.children",this.node.children,t),t.forEach(function(t){var i=Math.random()*Math.PI*2,a=Math.random()*e.spreadRadius,n=Math.cos(i)*a,s=Math.sin(i)*a;t.runAction(cc.spawn(cc.moveBy(.4,cc.v2(n,s)),cc.fadeOut(.4),cc.scaleTo(.4,.2)))})},setScore:function(e){this.coinLabel&&(this.coinLabel.string="+"+e,this.coinLabel.node.runAction(cc.sequence(cc.moveBy(.4,cc.v2(0,50)),cc.fadeOut(.4))))}}),cc._RF.pop()},{}],SpawnManager:[function(e,t){"use strict";cc._RF.push(t,"501d4tlsuBGr4e0wcljIQ6D","SpawnManager"),cc.Class({extends:cc.Component,properties:{animalPrefabs:{type:[cc.Prefab],default:[]},currentAnimal:{default:null,visible:!1}},onLoad:function(){this.isStopped=!1},stop:function(){this.isStopped=!0,this.currentAnimal&&(this.currentAnimal.destroy(),this.currentAnimal=null)},spawnAnimal:function(){if(!this.isStopped&&!(window.GameManager&&window.GameManager.isPaused||this.currentAnimal||0===this.animalPrefabs.length)){var e=Math.floor(Math.random()*this.animalPrefabs.length),t=cc.instantiate(this.animalPrefabs[e]);t.parent=this.node;var i=t.getComponent("AnimalCtrl"),a=Math.random()<.5,n=a?-360:360,s=300*Math.random()-150;t.setPosition(n,s),i&&(i.dir=a?1:-1,i.node.scaleX=a?.2:-.2,i.spawnManager=this),this.currentAnimal=t}},onAnimalDead:function(){var e=this;this.isStopped||window.GameManager&&window.GameManager.isPaused||(this.currentAnimal=null,this.scheduleOnce(function(){e.spawnAnimal()},.5))}}),cc._RF.pop()},{}]},{},["AnimalCtrl","AudioManager","BallistaCtrl","BloodBarCtrl","BoltCtrl","CoinTag","GameInit","GameManager","HitEffectCtrl","SpawnManager"]);